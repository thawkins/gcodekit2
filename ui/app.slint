import { StandardButton, TabWidget, VerticalBox, HorizontalBox, Button } from "std-widgets.slint";
import { ThemeProvider, ThemedRectangle, ThemedText, ThemedSecondaryText, ThemeToggleButton } from "theme-provider.slint";

/// Interactive button component with visual feedback
component InteractiveButton inherits Rectangle {
    in property <string> label;
    callback clicked;
    
    background: ThemeProvider.colors.button;
    border-radius: 3px;
    
    TouchArea {
        width: 100%;
        height: 100%;
        mouse-cursor: pointer;
        clicked => {
            root.clicked();
        }
    }
    
    ThemedText {
        text: root.label;
        horizontal-alignment: center;
        vertical-alignment: center;
        color: #FFFFFF;
    }
}

component MenuBar inherits Rectangle {
    background: ThemeProvider.colors.panel;
    height: 50px;
    
    private property <int> toggle_count: 0;
    
    callback settings_requested();
    callback file_menu();
    callback machine_menu();
    callback view_menu();
    callback tools_menu();
    callback help_menu();
    
    HorizontalLayout {
        padding: 10px;
        spacing: 20px;
        
        // File menu
        Rectangle {
            width: 50px;
            height: 32px;
            
            TouchArea {
                clicked => {
                    root.file_menu();
                }
            }
            
            ThemedText { 
                text: "File"; 
                font-size: 14px;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
        }
        
        // Machine menu
        Rectangle {
            width: 70px;
            height: 32px;
            
            TouchArea {
                clicked => {
                    root.machine_menu();
                }
            }
            
            ThemedText { 
                text: "Machine"; 
                font-size: 14px;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
        }
        
        // View menu
        Rectangle {
            width: 50px;
            height: 32px;
            
            TouchArea {
                clicked => {
                    root.view_menu();
                }
            }
            
            ThemedText { 
                text: "View"; 
                font-size: 14px;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
        }
        
        // Tools menu
        Rectangle {
            width: 50px;
            height: 32px;
            
            TouchArea {
                clicked => {
                    root.tools_menu();
                }
            }
            
            ThemedText { 
                text: "Tools"; 
                font-size: 14px;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
        }
        
        // Help menu
        Rectangle {
            width: 50px;
            height: 32px;
            
            TouchArea {
                clicked => {
                    root.help_menu();
                }
            }
            
            ThemedText { 
                text: "Help"; 
                font-size: 14px;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
        }
        
        Rectangle {
            width: 100%;
        }
        
        // Theme toggle button
        Rectangle {
            background: ThemeProvider.colors.button;
            width: 40px;
            height: 32px;
            border-radius: 3px;
            
            TouchArea {
                width: 100%;
                height: 100%;
                mouse-cursor: pointer;
                clicked => {
                    ThemeProvider.toggle-theme();
                    toggle_count += 1;
                }
            }
            
            Text {
                text: ThemeProvider.mode == "light" ? "ðŸŒ™" : "â˜€";
                color: ThemeProvider.colors.text-primary;
                font-size: 16px;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
        }
        
        // Settings button
        Rectangle {
            background: ThemeProvider.colors.button;
            width: 40px;
            height: 32px;
            border-radius: 3px;
            
            TouchArea {
                width: 100%;
                height: 100%;
                clicked => {
                    root.settings_requested();
                }
            }
            
            ThemedText {
                text: "âš™";
                font-size: 16px;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
        }
    }
}

component StatusBar inherits Rectangle {
    background: ThemeProvider.colors.panel;
    height: 30px;
    
    HorizontalLayout {
        padding: 5px;
        spacing: 20px;
        
        ThemedText {
            text: "Status: Idle";
            font-size: 11px;
        }
        
        ThemedText {
            text: "Position: X: 0.00 Y: 0.00 Z: 0.00";
            font-size: 11px;
        }
        
        ThemedText {
            text: "Version: GRBL v1.1h";
            font-size: 11px;
        }
        
        Rectangle {
            width: 100%;
        }
        
        // Theme indicator
        HorizontalLayout {
            spacing: 5px;
            
            ThemedText {
                text: "Theme:";
                font-size: 10px;
            }
            
            ThemedText {
                text: ThemeProvider.mode == "light" ? "â˜€ Light" : "ðŸŒ™ Dark";
                color: ThemeProvider.mode == "light" ? ThemeProvider.colors.status-yellow : #7B68EE;
                font-size: 10px;
                font-weight: 700;
            }
        }
    }
}

component LeftPanel inherits Rectangle {
    width: 250px;
    background: ThemeProvider.colors.background;
    
    // State for button feedback
    private property <int> button_press_count: 0;
    
    VerticalLayout {
        padding: 10px;
        spacing: 10px;
        
        ThemedText {
            text: "Machine Control";
            font-weight: 700;
            font-size: 14px;
        }
        
        ThemedRectangle {
            VerticalLayout {
                padding: 10px;
                spacing: 5px;
                
                ThemedText { text: "Connection"; font-size: 12px; font-weight: 700; }
                ThemedSecondaryText { text: "Status: Connected"; font-size: 11px; }
                ThemedSecondaryText { text: "Port: /dev/ttyACM0"; font-size: 11px; }
            }
        }
        
        ThemedRectangle {
            VerticalLayout {
                padding: 10px;
                spacing: 5px;
                
                ThemedText { text: "Jog Controls"; font-size: 12px; font-weight: 700; }
                ThemedSecondaryText { text: "Step Size: 1mm"; font-size: 11px; }
                
                // First row: Home, Stop, Unlock
                HorizontalLayout {
                    spacing: 5px;
                    
                    InteractiveButton {
                        label: "Home";
                        width: 50px;
                        height: 32px;
                        clicked => {
                            button_press_count += 1;
                        }
                    }
                    InteractiveButton {
                        label: "Stop";
                        width: 50px;
                        height: 32px;
                        clicked => {
                            button_press_count += 1;
                        }
                    }
                    InteractiveButton {
                        label: "Unlock";
                        width: 50px;
                        height: 32px;
                        clicked => {
                            button_press_count += 1;
                        }
                    }
                }
                
                // Second row: Y+
                HorizontalLayout {
                    spacing: 5px;
                    Rectangle { width: 20px; }
                    InteractiveButton {
                        label: "Y+";
                        width: 50px;
                        height: 32px;
                        clicked => {
                            button_press_count += 1;
                        }
                    }
                    Rectangle { width: 20px; }
                }
                
                // Third row: X-, Z-, X+
                HorizontalLayout {
                    spacing: 5px;
                    
                    InteractiveButton {
                        label: "X-";
                        width: 50px;
                        height: 32px;
                        clicked => {
                            button_press_count += 1;
                        }
                    }
                    InteractiveButton {
                        label: "Z-";
                        width: 50px;
                        height: 32px;
                        clicked => {
                            button_press_count += 1;
                        }
                    }
                    InteractiveButton {
                        label: "X+";
                        width: 50px;
                        height: 32px;
                        clicked => {
                            button_press_count += 1;
                        }
                    }
                }
                
                // Fourth row: Y-
                HorizontalLayout {
                    spacing: 5px;
                    Rectangle { width: 20px; }
                    InteractiveButton {
                        label: "Y-";
                        width: 50px;
                        height: 32px;
                        clicked => {
                            button_press_count += 1;
                        }
                    }
                    Rectangle { width: 20px; }
                }
                
                // Fifth row: Pause, Continue
                HorizontalLayout {
                    spacing: 5px;
                    
                    InteractiveButton {
                        label: "Pause";
                        width: 60px;
                        height: 32px;
                        clicked => {
                            button_press_count += 1;
                        }
                    }
                    InteractiveButton {
                        label: "Continue";
                        width: 60px;
                        height: 32px;
                        clicked => {
                            button_press_count += 1;
                        }
                    }
                }
            }
        }
        
        ThemedRectangle {
            VerticalLayout {
                padding: 10px;
                spacing: 5px;
                
                ThemedText { text: "Overrides"; font-size: 12px; font-weight: 700; }
                ThemedSecondaryText { text: "Feed: 100%"; font-size: 11px; }
                ThemedSecondaryText { text: "Power: 100%"; font-size: 11px; }
                ThemedSecondaryText { 
                    text: "Clicks: " + button_press_count; 
                    font-size: 10px;
                    color: ThemeProvider.colors.status-blue;
                }
            }
        }
        
        // Spacer to push widgets to top
        Rectangle {
            height: 100%;
        }
    }
}

component CenterPanel inherits Rectangle {
    background: ThemeProvider.colors.background;
    
    VerticalLayout {
        TabWidget {
            Tab {
                title: "G-code Editor";
                Rectangle { background: ThemeProvider.colors.background; }
            }
            Tab {
                title: "3D Visualizer";
                Rectangle { background: ThemeProvider.colors.background; }
            }
            Tab {
                title: "Device Console";
                Rectangle { background: ThemeProvider.colors.background; }
            }
            Tab {
                title: "Job Manager";
                Rectangle { background: ThemeProvider.colors.background; }
            }
            Tab {
                title: "Designer";
                Rectangle { background: ThemeProvider.colors.background; }
            }
        }
    }
}

component RightPanel inherits Rectangle {
    width: 250px;
    background: ThemeProvider.colors.background;
    
    VerticalLayout {
        padding-left: 10px;
        padding-top: 10px;
        padding-bottom: 10px;
        padding-right: 12.5px;  // 5% of 250px = 12.5px
        spacing: 10px;
        
        ThemedText {
            text: "CAM Functions";
            font-weight: 700;
            font-size: 14px;
        }
        
        ThemedRectangle {
            VerticalLayout {
                padding: 10px;
                spacing: 5px;
                
                ThemedText { text: "Shape Generation"; font-size: 12px; font-weight: 700; }
                HorizontalLayout {
                    spacing: 5px;
                    Rectangle {
                        background: ThemeProvider.colors.button;
                        width: 80px;
                        height: 32px;
                        border-radius: 3px;
                        
                        TouchArea {
                            width: 100%;
                            height: 100%;
                            clicked => {
                            }
                        }
                        
                        ThemedText { 
                            text: "Rectangle";
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                    }
                    Rectangle {
                        background: ThemeProvider.colors.button;
                        width: 80px;
                        height: 32px;
                        border-radius: 3px;
                        
                        TouchArea {
                            width: 100%;
                            height: 100%;
                            clicked => {
                            }
                        }
                        
                        ThemedText { 
                            text: "Circle";
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                    }
                }
            }
        }
        
        ThemedRectangle {
            VerticalLayout {
                padding: 10px;
                spacing: 5px;
                
                ThemedText { text: "Import"; font-size: 12px; font-weight: 700; }
                HorizontalLayout {
                    spacing: 5px;
                    Rectangle {
                        background: ThemeProvider.colors.button;
                        width: 80px;
                        height: 32px;
                        border-radius: 3px;
                        
                        TouchArea {
                            width: 100%;
                            height: 100%;
                            clicked => {
                            }
                        }
                        
                        ThemedText { 
                            text: "SVG/DXF";
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                    }
                    Rectangle {
                        background: ThemeProvider.colors.button;
                        width: 80px;
                        height: 32px;
                        border-radius: 3px;
                        
                        TouchArea {
                            width: 100%;
                            height: 100%;
                            clicked => {
                            }
                        }
                        
                        ThemedText { 
                            text: "Image";
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                    }
                }
            }
        }
        
        ThemedRectangle {
            height: 80px;
            
            VerticalLayout {
                padding: 10px;
                spacing: 5px;
                
                ThemedText { text: "Materials"; font-size: 12px; font-weight: 700; }
                ThemedSecondaryText { text: "Database loaded"; font-size: 11px; }
            }
        }
        
        // Spacer to push widgets to top
        Rectangle {
            height: 100%;
        }
    }
}

export component AppWindow inherits Window {
    width: 1600px;
    height: 1000px;
    title: "GCodeKit2 - GRBL Control v0.2.0-alpha";
    
    VerticalLayout {
        spacing: 0px;
        padding: 0px;
        
        MenuBar {
            settings_requested => {
                // TODO: Show settings panel
            }
        }
        
        HorizontalLayout {
            spacing: 0px;
            padding: 0px;
            
            LeftPanel { }
            CenterPanel { }
            RightPanel { }
        }
        
        StatusBar { }
    }
}
